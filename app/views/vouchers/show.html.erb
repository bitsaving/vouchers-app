<!-- <div class ="alert fade in alert-success onprint">
</div> --> 
<%# cache @voucher do %>
<div class ="voucher_display">
  <div>
  </div>
  <div class ="content">
    <div class = "voucherId"> 
      <%= @voucher.id %>
    </div>
  </div>
  <div class = "status onprint">
    <%= @voucher.workflow_state.capitalize%>
    <% if @voucher.assignee_id && @voucher.assignee_id != current_user.id%>
      <%= "(" %>
      <%= @voucher.assignee.name %>
      <%= ")"%>
    <%end%>
  </div>
  <div class ="date">
    <%= @voucher.date.to_s(:string_format) %> 
  </div>
   <div class = "edit_voucher onprint">
      <% if @voucher.can_be_edited? && @voucher.creator?(current_user)%>
        <%= link_to "Edit" ,edit_voucher_path(@voucher),:class=>'btn btn-primary',"data-no-turbolink" => true%> 
      <%end%>
    </div>
    <div class ="print_voucher">
      <%= link_to "Print" ,"javascript:print()",:class=>'btn btn-primary onprint'%> 
    </div>
  <div class = "separator">
  </div>
  <div class ="column_separator">
    
      <div class ="payment">
      <div class="amount">
        <% @sum = 0 %>
        <%@voucher.transactions.where(account_type: "debit").each do |voucher| %>
          <% @sum += voucher.amount %>
          <%end%> 
        <%= number_to_currency(@sum,:unit => "₹  ") %>
      </div>
    </div>
      
    <% if  (@voucher.drafted? || @voucher.pending?) && @voucher.assignee?(current_user) %>
      <%=  render 'assign' %>
    <%end%>
    <div class = "debitCredit">
      <div class="labels">Debit
      </div>
      <% @voucher.debit_from.each do |debit| %>
      <div>
        <%= link_to debit.name, account_vouchers_path(Account.find(debit))%>
        <strong><%=" - ₹ " + @voucher.transactions.where(account_id: debit.id).where(account_type: "debit").first.amount.to_s  %></strong>
         <span> Payment Mode: <%= @voucher.transactions.where(account_id: debit.id).where(account_type: "debit").first.payment_type  %></span>
        <% if  @voucher.transactions.where(account_id: debit.id).where(account_type: "debit").first.payment_reference.present? %>
        <span>Payment Reference: <%= @voucher.transactions.where(account_id: debit.id).where(account_type: "debit").first.payment_reference  %>
<%end%>
        </span>
       </div>
      <%end%>
   
    </div>
    <div class="debitCredit">
      <div class ="labels">Credit</div> 
      <% @voucher.credit_to.each do |credit| %>
      <div>
        <%= link_to credit.name, account_vouchers_path(Account.find(credit))%>
        <strong><%=" - ₹ " + @voucher.transactions.where(account_id: credit.id).where(account_type: "credit").first.amount.to_s  %></strong>
        <span> Payment Mode: <%= @voucher.transactions.where(account_id: credit.id).where(account_type: "credit").first.payment_type  %></span>
        <% if  @voucher.transactions.where(account_id: credit.id).where(account_type: "credit").first.payment_reference.present? %>
        <span>Payment Reference: <%= @voucher.transactions.where(account_id: credit.id).where(account_type: "credit").first.payment_reference  %>
<%end%>
        </span>
       </div>
      <%end%>
    
    </div>
    <% if @voucher.to_date %>
    <div class="date_period" >
      <div class ="date_field">From :</div>
        <%= @voucher.from_date.to_s(:string_format) %> 
      <div class="date_field" >To :</div>
        <%= @voucher.to_date.to_s(:string_format) %> 
    </div>
    <%end%>
     
  
    <%if(@voucher.approved?  && @voucher.assignee?(current_user))%>
    <div class ="final_state onprint">
      <%= link_to "Accept" , increment_state_voucher_path(id: @voucher),:class=>'btn btn-primary',method: :post%>
      <%= link_to "Reject" , decrement_state_voucher_path(id: @voucher), :class=>'btn btn-danger',method: :post,data: {confirm: "Voucher ##{@voucher.id} will be rejected and assigned back to #{@voucher.creator.name}.Press OK to continue "}%>
    </div>
    <%end%>

    <% counter = 0 %>
    <%if @voucher.attachments.length > 0 %>
      <div class ="debitCredit">
        <div class="labels">Bill attachments
        </div>
        <% @voucher.attachments.each do |attachment|  %> 
          <div><%= (counter += 1).to_s+". "%><%= link_to attachment.tagname ,attachment.bill_attachment.url(:original, false) , :target => "_blank" %></div>     
             <%end%>
      </div> 
    <%end%>
    <%if @voucher.tag_list.length >0 %>
     <div class="tags">
      Tags:<%=  raw @voucher.tag_list.map {|t| link_to t,  tag_path(URI::escape t),:class=>"taglist"}.join(' ') %>
    </div>
    <%end%>
    <%if !@voucher.creator_id.nil?%>
      <div class="status_label">
        <div class ="created_by">
          <div>
            <%= "Created By :   " %>
            <%= link_to @voucher.creator.name ,user_vouchers_path(@voucher.creator_id)%>
          </div>
        </div>
      <%end%>
    <%if !@voucher.approved_by.nil?%>
   
        <div class ="approved_by">
          <div>
            <%= "Approved By :   " %>
            <%= link_to @voucher.approved_by_user.name ,user_vouchers_path(@voucher.approved_by)%>
          </div>
        </div>
      <%end%>
      <%if !@voucher.accepted_by.nil?%>
        <div class ="accepted_by">
          <div>
            <%= "Accepted By : " %>
            <%= link_to @voucher.accepted_by_user.name,user_vouchers_path(@voucher.accepted_by)%>   
          </div>
        </div>
      <%end%>
    </div>
  

    
    

    <%= render :template => 'comments/_comments', locals: {voucher: @voucher } %>

  </div>
</div>
<%#end%>