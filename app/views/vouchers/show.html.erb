<%# cache @voucher do %>
<div class = "edit_voucher onprint">
      <% if @voucher.can_be_edited?(current_user) %>
        <%= link_to "Edit", edit_voucher_path(@voucher), :class => 'btn btn-primary', "data-no-turbolink" => true%> 
      <%end%>
    </div>
    <div class ="print_voucher">
      <%= link_to "Print", "javascript:print()", :class => 'btn btn-primary onprint'%> 
    </div>
<div class ="voucher_display">
  <div></div>
<div class ="company_tag">
      VINAYAK SOLUTIONS
  </div>
  <div class = "status onprint">
    <%= @voucher.workflow_state.capitalize %>
    <% if @voucher.assignee_id && !@voucher.assignee?(current_user) %>
      <%= "(" %>
      <%= @voucher.assignee.name %>
      <%= ")"%>
    <%end%>
  </div>
  
  <div class ="date">
    <%= @voucher.date.to_s(:string_format) %> 
  </div>
   
  <div class = "separator">
  </div>
  <div class = "column_separator">
    <div class = "payment">
      <div class = "amount">
        <%= number_to_currency(@voucher.total_amount('debit'), :unit => "₹  ") %>
      </div>
    </div>    
    <% if ((@voucher.drafted? || @voucher.pending? || @voucher.rejected? ) && @voucher.assignee?(current_user)) %>
      <%=  render 'assign' %>
    <%end%>
    
    <div class = "debitCredit">
      <div class="labels">Debit
      </div>
           <table class="debited_credited_vouchers">
          <th width = 40%>Account</th>
          <th width = 20%>Amount</th>
          <th width = 40%> Details</th>
          <tbody>

      <% @voucher.debited_transactions.each do |debit| %>
        <tr>
              <td><%= link_to debit.account.name, account_vouchers_path(debit.account) %></td>
          <td><%=" ₹ " + debit.amount.to_s  %></td>
           <td> Payment Mode: <%= debit.payment_type %></br>
          <% if  debit.payment_reference.present? %>
          Payment Reference: <%= debit.payment_reference  %>
          <%end%>
        </td>
        </tr>
      <%end%>
    </table>

    </div>
    <div class="debit_separator"></div>
    <div class="debitCredit">
      <div class ="labels">Credit</div> 
       <table class="debited_credited_vouchers" >
          <th width  = 40% >Account</th>
          <th width  = 20% >Amount</th>
          <th width = 40%> Details</th>
          <tbody>

      <% @voucher.credited_transactions.each do |credit| %>
        <tr>
          <td><%= link_to credit.account.name, account_vouchers_path(credit.account) %></td>
          <td><%=" ₹ " + credit.amount.to_s  %></td>
           <td> Payment Mode: <%= credit.payment_type %></br>
          <% if  credit.payment_reference.present? %>
          Payment Reference: <%= credit.payment_reference  %>
          <%end%>
        </td>
        </tr>
      <%end%>
    </table>
    </div>
    <% if @voucher.to_date %>
      <div class="date_period" >
        <div class ="date_field">From :</div>
          <%= @voucher.from_date.to_s(:string_format) %> 
        <div class="date_field" >To :</div>
          <%= @voucher.to_date.to_s(:string_format) %> 
      </div>
    <%end%>
   <%if(@voucher.approved?  && @voucher.assignee?(current_user))%>
      <div class ="final_state onprint">
        <%= link_to "Accept", increment_state_voucher_path(id: @voucher, :voucher => {:assignee_id => current_user.id }), :class => 'btn btn-primary', method: :post %>
        <%= link_to "Reject", decrement_state_voucher_path(id: @voucher), :class=>'btn btn-danger', method: :post, data: {confirm: "Voucher ##{@voucher.id} will be rejected and assigned back to #{@voucher.creator.name}.Press OK to continue "}%>
      </div>
    <%end%>
    <% counter = 0 %>
    <%if @voucher.attachments.length > 0 %>
      <div class ="debitCredit">
        <div class="labels">Bill attachments
        </div>
        <% @voucher.attachments.each do |attachment|  %> 
          <div><%= (counter += 1).to_s + "." %><%= link_to (attachment.tagname.presence || attachment.bill_attachment_file_name), attachment.bill_attachment.url(:original, false), :target => "_blank" %></div>     
        <%end%>
      </div> 
    <%end%>
    <% if @voucher.description.present? %>
      <div class="description">
        <div class="description_label"> Description </div>
        <div class="description_content"><%= @voucher.description %></div>
      </div>
    <%end%>
    <%if @voucher.tag_list.length >0 %>
      <div class="tags">
        Tags:<%=  raw @voucher.tag_list.map {|t| link_to t,  tag_path(URI::escape t), :class => "taglist" }.join(' ') %>
      </div>
    <%end%>
    <%if @voucher.creator_id.present? %>
      <div class="status_label">
        <div class ="created_by">
          <div>
            <%= "Created By :   " %>
            <%= link_to @voucher.creator.name, user_vouchers_path(@voucher.creator_id)%>
          </div>
        </div>
      <%end%>
      <%if @voucher.approved_by.present? %>
        <div class ="approved_by">
          <div>
            <%= "Approved By :   " %>
            <%= link_to @voucher.approved_by_user.name, user_vouchers_path(@voucher.approved_by)%>
          </div>
        </div>
      <%end%>
      <%if @voucher.accepted_by.present?%>
        <div class ="accepted_by">
          <div>
            <%= "Accepted By : " %>
            <%= link_to @voucher.accepted_by_user.name, user_vouchers_path(@voucher.accepted_by)%>   
          </div>
        </div>
      <%end%>
    </div>
    <%= render :template => 'comments/_comments', locals: {voucher: @voucher } %>
  </div>
</div>
<%#end%>